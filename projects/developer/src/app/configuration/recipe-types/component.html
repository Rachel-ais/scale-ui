<div class="recipe-type__header">
    <h2><i class="fa fa-cubes"></i> Recipe Types</h2>
    <p-dropdown [options]="recipeTypeOptions" [autoWidth]="false" [(ngModel)]="selectedRecipeTypeOption" filter="filter"
                class="recipe-type__options" (onChange)="onRowSelect($event)" placeholder="Select..."
                [showClear]="false"></p-dropdown>
    <button pButton class="btn__new-recipe" icon="fa fa-plus" (click)="createNewRecipe()"
            [disabled]="recipeTypeName === 'new'"></button>
</div>
<hr />
<div class="text-center" *ngIf="!selectedRecipeTypeDetail && recipeTypeName !== 'create'">
    <h3>Select a recipe type to view its details</h3>
</div>
<div class="scale-chart-container">
    <dev-loading-indicator [loading]="loadingRecipeType"></dev-loading-indicator>
    <div class="recipe-type__details" *ngIf="selectedRecipeTypeDetail">
        <p-panel>
            <p-header class="flexed space-between">
                <div>
                    {{ selectedRecipeTypeDetail.title }}
                </div>
                <div class="recipe-type__menu">
                    <p-menu #menu [popup]="true" [model]="items" appendTo="body"></p-menu>
                    <button pButton type="button" class="ui-button-secondary" icon="fa fa-bars"
                            (click)="menu.toggle($event)"></button>
                </div>
            </p-header>
            <div class="margin-bottom-md" *ngIf="!isEditing">
                {{ selectedRecipeTypeDetail.description }}
            </div>
            <div class="ui-g" *ngIf="isEditing">
                <div class="ui-g-12">
                    <div [formGroup]="createForm">
                        <label>
                            <span>Title</span>
                            <input pInputText type="text" formControlName="title"/>
                        </label>
                        <label>
                            <span>Description</span>
                            <textarea pInputTextarea formControlName="description" rows="5"></textarea>
                        </label>
                    </div>
                </div>
            </div>
            <div class="ui-g" *ngIf="isEditing">
                <div class="ui-g-6">
                    <div [formGroup]="definitionFileForm">
                        <p-panel [collapsed]="true" [toggleable]="true" collapseIcon="fa fa-caret-up"
                                 expandIcon="fa fa-caret-down" toggler="header">
                            <p-header>
                                <strong>Input Files</strong>
                            </p-header>
                            <div class="ui-g">
                                <div class="ui-g-6">
                                    <label>
                                        <span>Name</span>
                                        <input type="text" pInputText formControlName="name" required/>
                                        <div class="help-block">
                                            The unique name of the parameter (required)
                                        </div>
                                    </label>
                                </div>
                                <div class="ui-g-6">
                                    <label>
                                        <span>Required</span>
                                        <p-toggleButton formControlName="required" onLabel="Required" offLabel="Optional"
                                                        onIcon="fa fa-check" offIcon="fa fa-circle"
                                                        [style]="{'width':'100%', 'display':'block'}"
                                                        (onChange)="onToggleClick($event)"></p-toggleButton>
                                    </label>
                                </div>
                            </div>
                            <div class="ui-g">
                                <div class="ui-g-6">
                                    <label>
                                        <span>Media Types</span>
                                        <p-chips formControlName="media_types" [style]="{'width':'100%'}"
                                                 [inputStyle]="{'width':'100%'}" [addOnBlur]="true"></p-chips>
                                        <div class="help-block">
                                            List of strings describing the accepted media types for the parameterâ€™s file(s)
                                            (optional)
                                        </div>
                                    </label>
                                </div>
                                <div class="ui-g-6">
                                    <label>
                                        <span>Files Accepted</span>
                                        <p-toggleButton formControlName="multiple" onLabel="Multiple Files"
                                                        offLabel="Single File" onIcon="fa fa-clone" offIcon="fa fa-file"
                                                        [style]="{'width':'100%', 'display':'block'}"
                                                        (onChange)="onToggleClick($event)"></p-toggleButton>
                                    </label>
                                </div>
                            </div>
                            <div class="text-center">
                                <button pButton icon="fa fa-plus" (click)="onAddFileClick()"
                                        label="Add File to Input"
                                        [disabled]="definitionFileForm.status === 'INVALID'"></button>
                            </div>
                            <h3>Current Files</h3>
                            <div *ngIf="selectedRecipeTypeDetail.definition">
                                <span *ngIf="selectedRecipeTypeDetail.definition.files_display.length === 0">
                                    No files in definition.
                                </span>
                                <div *ngFor="let file of selectedRecipeTypeDetail.definition.files_display">
                                    <pre class="flexed space-between">
                                        <span>{{ file.label }}</span>
                                        <button pButton class="ui-button-danger" icon="fa fa-remove"
                                                pTooltip="Remove File" (click)="onRemoveFileClick(file.value)"></button>
                                    </pre>
                                </div>
                            </div>
                            <div *ngIf="!selectedRecipeTypeDetail.definition">
                                No files in definition.
                            </div>
                        </p-panel>
                    </div>
                </div>
                <div class="ui-g-6">
                    <div [formGroup]="definitionJsonForm">
                        <p-panel [collapsed]="true" [toggleable]="true" collapseIcon="fa fa-caret-up"
                                 expandIcon="fa fa-caret-down" toggler="header">
                            <p-header>
                                Input JSON
                            </p-header>
                            <div class="ui-g">
                                <div class="ui-g-12">
                                    <label>
                                        <span>Name</span>
                                        <input type="text" pInputText formControlName="name" required/>
                                        <div class="help-block">
                                            The unique name of the parameter (required)
                                        </div>
                                    </label>
                                    <label>
                                        <span>Required</span>
                                        <p-toggleButton formControlName="required" onLabel="Required"
                                                        offLabel="Optional" onIcon="fa fa-check" offIcon="fa fa-circle"
                                                        [style]="{'width':'100%', 'display':'block'}"
                                                        (onChange)="onToggleClick($event)"></p-toggleButton>
                                    </label>
                                    <label>
                                        <span>Type</span>
                                        <input type="text" pInputText formControlName="type"/>
                                        <div class="help-block">
                                            The accepted JSON data type. Must be one of 'array', 'boolean', 'integer',
                                            'number', 'object', or 'string'. (required)
                                        </div>
                                    </label>
                                    <div class="text-center">
                                        <button pButton icon="fa fa-plus" (click)="onAddJsonClick()"
                                                label="Add JSON to Input"
                                                [disabled]="definitionJsonForm.status === 'INVALID'"></button>
                                    </div>
                                    <h3>Current JSON</h3>
                                    <div *ngIf="selectedRecipeTypeDetail.definition">
                                        <span *ngIf="selectedRecipeTypeDetail.definition.json_display.length === 0">
                                            No JSON in definition.
                                        </span>
                                        <div *ngFor="let json of selectedRecipeTypeDetail.definition.json_display">
                                            <pre class="flexed space-between">
                                                <span>{{ json.label }}</span>
                                                <button pButton class="ui-button-danger" icon="fa fa-remove"
                                                        pTooltip="Remove JSON" (click)="onRemoveJsonClick(json.value)"></button>
                                            </pre>
                                        </div>
                                    </div>
                                    <div *ngIf="!selectedRecipeTypeDetail.definition">
                                        No JSON in definition.
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>
            </div>
            <div class="ui-g">
                <div class="ui-g-12">
                    <div class="margin-bottom-sm">
                        <div *ngIf="isEditing">
                            <label class="no-margin">Nodes</label>
                            <p-menubar [model]="menuBarItems" [style]="{'margin-bottom':'0'}"></p-menubar>
                        </div>
                        <dev-recipe-graph [recipeData]="selectedRecipeTypeDetail" [isEditing]="isEditing"
                                          [minHeight]="recipeGraphMinHeight"></dev-recipe-graph>
                    </div>
                </div>
            </div>
        </p-panel>
    </div>
</div>
<p-dialog #addRemoveDialog [(visible)]="showAddRemoveDisplay" (onHide)="hideDialog()" (onShow)="showDialog()"
          styleClass="add-remove-dialog">
    <p-header>
        <span *ngIf="addRemoveDisplayType === 'job'">
            <strong>Add/Remove Job Types</strong>
        </span>
        <span *ngIf="addRemoveDisplayType === 'recipe'">
            <strong>Add/Remove Recipe Types</strong>
        </span>
    </p-header>
    <div class="dialog-content" *ngIf="addRemoveDisplayType === 'job'">
        <p-scrollPanel [style]="{width: '100%', height: '33vh'}">
            <p-table [columns]="jobTypeColumns" [value]="jobTypes" styleClass="nopadding" [rowHover]="true"
                     (onRowSelect)="addJobTypeNode($event)" (onRowUnselect)="removeNode($event)"
                     selectionMode="multiple" [(selection)]="selectedJobTypes" #jobTypeDatatable>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns">
                            <input pInputText type="text"
                                   (input)="jobTypeDatatable.filter($event.target.value, col.field, col.filterMatchMode)"
                                   class="column-filter">
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td>
                            <div class="recipe-type__node-type-row">
                                <span class="fa fa-fw" [innerHtml]="getUnicode(rowData.icon_code)"></span>
                                {{ rowData.title }} v{{ rowData.latest_version }}
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-scrollPanel>
    </div>
    <div class="dialog-content" *ngIf="addRemoveDisplayType === 'recipe'">
        <p-scrollPanel [style]="{width: '100%', height: '33vh'}">
            <p-table [columns]="recipeTypeColumns" [value]="recipeTypes" styleClass="nopadding" [rowHover]="true"
                     (onRowSelect)="addRecipeTypeNode($event)" (onRowUnselect)="removeNode($event)"
                     selectionMode="multiple" [(selection)]="selectedRecipeTypes" #recipeTypeDatatable>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns">
                            <input pInputText type="text"
                                   (input)="recipeTypeDatatable.filter($event.target.value, col.field, col.filterMatchMode)"
                                   class="column-filter">
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td>
                            <div class="recipe-type__node-type-row">
                                {{ rowData.title }}
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-scrollPanel>
    </div>
</p-dialog>
